library(tidyverse)
library(binom)
library(kableExtra)
data <- read.csv("pedestrians.csv")
library(tidyverse)
library(binom)
library(kableExtra)
data <- read.csv("pedestrians.csv")
long_data <- data |>
pivot_longer(
cols = everything(),
names_to = "location",
values_to = "count"
) |>
mutate(count = as.numeric(count))
library(tidyverse)
library(binom)
library(kableExtra)
data <- read.csv("pedestrians.csv")
long_data <- data |>
pivot_longer(
cols = everything(),
names_to = "location",
values_to = "count"
) |>
mutate(count = as.numeric(count))
days_data <- long_data |>
group_by(location) |>
summarise(
n_days = n(),
busy_days = sum(count > 1000, na.rm = TRUE),
prop_busy = busy_days / n_days
) |>
mutate(
ci = map2(busy_days, n_days,
~ binom.confint(.x, .y, conf.level = 0.95, methods = "wilson")),
p_low = map_dbl(ci, "lower"),
p_high = map_dbl(ci, "upper"),
revenue_est = 10000 + 5000 * prop_busy,
revenue_low = 10000 + 5000 * p_low,
revenue_high = 10000 + 5000 * p_high
) |>
select(location, n_days, busy_days, prop_busy, p_low, p_high,
revenue_est, revenue_low, revenue_high)
View(days_data)
View(long_data)
days_data <- long_data |>
group_by(location) |>
summarise(
n_days = n(),
busy_days = sum(count > 1000, na.rm = TRUE),
prop_busy = busy_days / n_days
) |>
mutate(
ci = map2(busy_days, n_days,
~ binom.confint(.x, .y, conf.level = 0.95, methods = "wilson")),
p_low = map_dbl(ci, "lower"),
p_high = map_dbl(ci, "upper"),
revenue_est = 10000 + 5000 * prop_busy,
revenue_low = 10000 + 5000 * p_low,
revenue_high = 10000 + 5000 * p_high
) |>
select(location, n_days, busy_days, prop_busy, p_low, p_high,
revenue_est, revenue_low, revenue_high)
colors <- c("yellow", "skyblue", "pink")
days_data |>
mutate(
revenue_est = as.numeric(gsub("[$,]", "", revenue_est)),
revenue_low = as.numeric(gsub("[$,]", "", revenue_low)),
revenue_high = as.numeric(gsub("[$,]", "", revenue_high)),
location = str_replace_all(location, "_", " ") |> str_to_title()
) |>
ggplot(aes(x = reorder(location, revenue_est),
y = revenue_est,
fill = location)) +
geom_col(width = 0.65, alpha = 0.9, show.legend = FALSE) +
geom_errorbar(aes(ymin = revenue_low, ymax = revenue_high),
width = 0.15, colour = "black", linewidth = 0.8) +
geom_text(aes(label = paste0("$", format(round(revenue_est, 0), big.mark=","))),
vjust = -1, size = 4.5, fontface = "bold") +
scale_fill_manual(values = colors) +
scale_y_continuous(labels = scales::dollar_format(accuracy = 1),
limits = c(0, 16000), expand = c(0, 200)) +
labs(
title = "Expected Billboard Revenue by Location (with 95% Confidence Intervals)",
x = "Pedestrian Crossing",
y = "Expected Revenue ($)"
) +
theme_minimal(base_size = 10) +
theme(
plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
axis.title.y = element_text(face = "bold"),
axis.title.x = element_text(face = "bold", margin = margin(t = 10)),
panel.grid.minor = element_blank()
)
mean_num <- data |>
pivot_longer(everything(), names_to = "Crossing", values_to = "Pedestrians") |>
group_by(Crossing) |>
summarise(
n   = n(),
mean = mean(Pedestrians),
sd   = sd(Pedestrians),
se   = sd/sqrt(n),
tcrit = qt(0.975, df = n - 1),
lo = mean - tcrit*se,
hi = mean + tcrit*se,
.groups = "drop")
mean_num
df_1<- mean_num |>
mutate(xmin = mean - 4*se, xmax = mean + 4*se) |>
group_by(Crossing) |>
do({
x <- seq(.$xmin, .$xmax, length.out = 400)
data.frame(
Crossing = .$Crossing,
x = x,
density = dnorm(x, mean = .$mean, sd = .$se))}) |>
ungroup()
p_clt <- ggplot(dens_df, aes(x = x, y = density, fill = Crossing, colour = Crossing)) +
geom_area(alpha = 0.25, position = "identity") +
geom_line(size = 1) +
labs(
title = "Mean ",
subtitle = sprintf("Dashed line = reference value (%.1f)", ref_value),
x = "Mean estimate (people/hour)",
y = "Density",
fill = "Crossing", colour = "Crossing") +
theme_minimal(base_size = 12)
